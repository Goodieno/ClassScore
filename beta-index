<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>학급 점수판</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f9fafb; }
h1,h2{margin-bottom:16px;}
ul{list-style:none;padding:0;}
li{margin:10px 0;}
button.link-btn{background:none;border:none;color:#2563eb;font-size:18px;cursor:pointer;padding:0;}
button.link-btn:hover{text-decoration:underline;}
.leader-text{margin-left:8px;font-weight:bold;color:#15803d;}
.leader-score{color:#000;margin-left:4px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));max-width:1000px;margin:0 auto;gap:14px;}
.card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:12px;}
.class-name{font-weight:bold;color:#2563eb;}
.points{font-weight:bold;color:#14532d;float:right;}
.controls{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:8px;}
.controls input{grid-column:span 2;padding:6px;}
.controls button{padding:8px;border:none;color:#fff;font-weight:bold;border-radius:6px;cursor:pointer;}
.btn-add{background:#16a34a;}
.btn-take{background:#dc2626;}
.btn-undo{grid-column:span 2;background:#6b7280;}
.reasons-wrapper{margin-top:10px;max-height:180px;overflow-y:auto;border:1px solid #ddd;padding:8px;border-radius:8px;background:#f9fafb;}
.reason-entry{font-size:14px;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed #ccc;}
.reason-entry:last-child{border-bottom:none;}
.reason-time{font-size:12px;color:#555;}
.reason-add{color:#14532d;font-weight:bold;}
.reason-take{color:#b91c1c;font-weight:bold;}
.admin-link{position:fixed;bottom:10px;right:10px;opacity:0.7;z-index:1000;}
.admin-link button{font-size:12px;color:#555;}
</style>
</head>
<body>

<div id="home">
  <h1>학년 선택</h1>
  <ul id="grade-links"></ul>
</div>

<div id="view"></div>

<div class="admin-link">
  <button class="link-btn" id="admin-link">⚙️ Admin</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAfFbHdfoXoOLw7rD-nd8HPSaZR6OBBYf8",
  authDomain: "tally-v-2.firebaseapp.com",
  databaseURL: "https://tally-v-2-default-rtdb.firebaseio.com",
  projectId: "tally-v-2",
  storageBucket: "tally-v-2.appspot.com",
  messagingSenderId: "193194015446",
  appId: "1:193194015446:web:41f010ef36a74df776a777"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let grades = {};
let classCards = {};
let currentGrade = null;

function loadData() {
  db.ref("grades").on("value", snapshot => {
    grades = snapshot.val() || {};
    if(currentGrade) renderGrade(currentGrade, true);
    else renderHome();
  });
}

/* ✅ SAFE WRITE */
function saveClassPoints(gradeName, className, data) {
  db.ref(`grades/${gradeName}/${className}`).update({
    points: data.points || 0,
    reasons: data.reasons || []
  });
}

/* rest of your file is unchanged */
loadData();
</script>

</body>
</html>
